#include "iob_soc_boot_conf.h"
#include "iob_soc_conf.h"
#include "iob_soc_periphs.h"

// Can't include iob_soc_boot_swreg.h because the assembler doesn't recognize stdint.h,
// so define the constants here instead (these are address offsets).
#define IOB_SOC_BOOT_ROM 0
#define IOB_SOC_BOOT_CTR 0

#define BOOTROM (BOOT0_BASE + IOB_SOC_BOOT_ROM)
#define BOOTRAM (1 << 31)
#define LENGTH (1 << IOB_SOC_BOOT_BOOT_ROM_ADDR_W)

.section .init
.globl _start

_start:
   li x1, LENGTH
   li x2, BOOTROM
   li x3, BOOTRAM

copy_loop:
   lw x4, 0(x2)
   sw x4, 0(x3)
   addi x2, x2, 4
   addi x3, x3, 4
   addi x1, x1, -1
   bge x1, x0, copy_loop

//reboot to run bootloader
li s5, 1
li s6, BOOT0_BASE + IOB_SOC_BOOT_CTR
sw s5, 0(s6)

ebreak
